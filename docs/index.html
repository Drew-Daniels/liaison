<!DOCTYPE html><html class="default" lang="en"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>Liaison Documentation</title><meta name="description" content="Documentation for Liaison Documentation"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">Liaison Documentation</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h2>Liaison Documentation</h2></div><div class="tsd-panel tsd-typography"><a id="md:liaison" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Liaison<a href="#md:liaison" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p><em>Liaison</em> is a simple library with 0 dependencies that enables easy, secure communication between a browser window and embedded iframes, using the browser <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage">postMessage</a> API.</p>
<blockquote>
<p>The window.postMessage() method safely enables cross-origin communication between Window objects; e.g., between a page and a pop-up that it spawned, or between a page and an iframe embedded within it.</p>
</blockquote>
<a id="md:use-case" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Use Case<a href="#md:use-case" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>postMessage</code> API allows for easy cross-origin resource sharing between windows and embedded applications, however you still need to:</p>
<ul>
<li>Manually create event listeners that listen for <code>MessageEvents</code> from specific origins</li>
<li>Manage removal of event listeners where necessary - such as in <code>React</code> applications, where you need to ensure that they are removed when a component is unmounted</li>
<li>Define an API contract between window and iframe code that can be used to reliably transmit data across applications
<ul>
<li>This is especially difficult if you only have control over one application's code</li>
</ul>
</li>
</ul>
<p><code>liaison</code> makes it easy to just define who you expect to receive messages from, and how you want these messages to be handled when they occur without needing to worry about all of the other implementation details around using the <code>postMessage</code> API.</p>
<a id="md:examples" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Examples<a href="#md:examples" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><a id="md:authentication" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Authentication<a href="#md:authentication" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Often times the user using the parent window application will be associated in some way to the user using the embedded application, so it's helpful to have some sort of mechanism that allows information about the user to be shared across these applications. This could be anything from metadata about the user, or authorization tokens allowing the embedded application to authenticate with some external API on behalf of that user.</p>
<a id="md:events" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Events<a href="#md:events" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>When you want some event to occur in one application as a result of something happening in the other. An example could be that when an application is loaded in an iframe, you want it to request the parent application for the authorization token belonging to the user using the parent window application. You could use <code>liaison</code> to dispatch a <code>MessageEvent</code> to the parent window that will result in the authorization token being sent back to the iframe application.</p>
<a id="md:parentcontact-model" class="tsd-anchor"></a><h3 class="tsd-anchor-link"><code>ParentContact</code> Model<a href="#md:parentcontact-model" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>ParentContract</code> model is used to define functions (<code>Effects</code>) that can be run in the parent application whenever the iframe application requests they be run.</p>
<a id="md:iframecontract-model" class="tsd-anchor"></a><h3 class="tsd-anchor-link"><code>IFrameContract</code> Model<a href="#md:iframecontract-model" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>IFrameContract</code> model is used to define functions (<code>Effects</code>) that can be run the iframe application whenever the parent application requests they be run.</p>
<a id="md:effects" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Effects<a href="#md:effects" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>An <code>Effect</code> is a function defined on one model, that the the other model can request be called at anytime. These functions can be synchronous or asynchronous.</p>
<pre><code class="js"><br/><span class="hl-0">// In the iframe application code, we use the &quot;IFrameContract&quot; class to:</span><br/><span class="hl-0">// - initialize event listeners for any MessageEvents that come from the parent window with an origin of &quot;https://my-application.com&quot;</span><br/><span class="hl-0">// - get a reference to a callback function, &quot;cb&quot; so we can dispatch MessageEvents to the parent window with an origin of &quot;https://my-application.com&quot;</span><br/><span class="hl-1">const</span><span class="hl-2"> { </span><span class="hl-3">cb</span><span class="hl-2">: </span><span class="hl-4">callParentEffect</span><span class="hl-2"> } = </span><span class="hl-1">new</span><span class="hl-2"> </span><span class="hl-5">IFrameContract</span><span class="hl-2">({</span><br/><span class="hl-2">  </span><span class="hl-3">targetOrigin:</span><span class="hl-2"> </span><span class="hl-6">&#39;https://my-application.com&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-3">effects:</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-5">onParentLogout</span><span class="hl-3">:</span><span class="hl-2"> () </span><span class="hl-1">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-5">setUser</span><span class="hl-2">(</span><span class="hl-1">null</span><span class="hl-2">);</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">})</span><br/><br/><span class="hl-0">// Here we are defining a function that, when called, will update the internal state of the iframe application, as well as notify the parent application that the user has logged out in the iframe</span><br/><span class="hl-1">function</span><span class="hl-2"> </span><span class="hl-5">logout</span><span class="hl-2">() {</span><br/><span class="hl-2">  </span><span class="hl-5">setUser</span><span class="hl-2">(</span><span class="hl-1">null</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-5">callParentEffect</span><span class="hl-2">({</span><br/><span class="hl-2">    </span><span class="hl-3">name:</span><span class="hl-2"> </span><span class="hl-6">&#39;onIFrameLogout&#39;</span><br/><span class="hl-2">  })</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-0">// In the parent application code, we use the &quot;ParentContract&quot; class to:</span><br/><span class="hl-0">// - initialize event listeners for any MessageEvents that come from the iframe window with an id of &quot;my-embedded-iframe&quot; and origin of &quot;https://my-iframe-application.com&quot;</span><br/><span class="hl-0">// - get a reference to a callback function, &quot;cb&quot; so we can dispatch MessageEvents to this iframe application</span><br/><br/><span class="hl-1">const</span><span class="hl-2"> { </span><span class="hl-3">cb</span><span class="hl-2">: </span><span class="hl-4">callIFrameEffect</span><span class="hl-2"> } = </span><span class="hl-1">new</span><span class="hl-2"> </span><span class="hl-5">ParentContract</span><span class="hl-2">({</span><br/><span class="hl-2">    </span><span class="hl-3">iframeId:</span><span class="hl-2"> </span><span class="hl-6">&#39;my-embedded-iframe&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-3">iframeSrc:</span><span class="hl-2"> </span><span class="hl-6">&#39;https://my-iframe-application.com&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-3">effects:</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-5">onIFrameLogout</span><span class="hl-3">:</span><span class="hl-2"> () </span><span class="hl-1">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">        </span><span class="hl-5">setUser</span><span class="hl-2">(</span><span class="hl-1">null</span><span class="hl-2">)</span><br/><span class="hl-2">      },</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-1">function</span><span class="hl-2"> </span><span class="hl-5">login</span><span class="hl-2">() {</span><br/><span class="hl-2">  </span><span class="hl-5">callIFrameEffect</span><span class="hl-2">({</span><br/><span class="hl-2">    </span><span class="hl-3">name:</span><span class="hl-2"> </span><span class="hl-6">&#39;onParentLogin&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-3">args:</span><span class="hl-2"> {</span><br/><span class="hl-2">      </span><span class="hl-3">email:</span><span class="hl-2"> </span><span class="hl-6">&#39;user@email.com&#39;</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">  })</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-1">function</span><span class="hl-2"> </span><span class="hl-5">logout</span><span class="hl-2">() {</span><br/><span class="hl-2">  </span><span class="hl-5">callIFrameEffect</span><span class="hl-2">({</span><br/><span class="hl-2">    </span><span class="hl-3">name:</span><span class="hl-2"> </span><span class="hl-6">&#39;onParentLogout&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">    </span><span class="hl-3">args:</span><span class="hl-2"> {}</span><br/><span class="hl-2">  })</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<a id="md:message-handling-signals" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Message Handling (<code>Signals</code>)<a href="#md:message-handling-signals" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>When the parent window receives a <a href="https://developer.mozilla.org/en-US/docs/Web/API/MessageEvent">MessageEvent</a>, the Parent model checks if:</p>
<ul>
<li>If the MessageEvent has an <code>origin</code> exactly matching <code>src</code>.
<ul>
<li>If the message has <em>any other origin</em> than <code>src</code>, it is completely ignored.</li>
</ul>
</li>
<li>If the <code>origin</code> matches <code>src</code>, the Parent model checks to ensure that the data passed in the <code>MessageEvent</code> matches the expected API (i.e., contains a <code>Signal</code>)</li>
<li>If the <code>MessageEvent</code> contains a <code>Signal</code>, this <code>Signal</code> is then used to call a corresponding <code>Effect</code> on the IFrame model.</li>
</ul>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:liaison"><span>Liaison</span></a><ul><li><a href="#md:use-case"><span>Use <wbr/>Case</span></a></li><li><a href="#md:examples"><span>Examples</span></a></li><li><ul><li><a href="#md:authentication"><span>Authentication</span></a></li><li><a href="#md:events"><span>Events</span></a></li></ul></li><li><a href="#md:parentcontact-model"><span>Parent<wbr/>Contact <wbr/>Model</span></a></li><li><a href="#md:iframecontract-model"><span>IFrame<wbr/>Contract <wbr/>Model</span></a></li><li><ul><li><a href="#md:effects"><span>Effects</span></a></li><li><a href="#md:message-handling-signals"><span>Message <wbr/>Handling (<wbr/>Signals)</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="index.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>Liaison Documentation</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
